/*
 http://www.gnu.org/licenses/gpl.html GNU General Public License, version 3 or later
*/
var SvpStarter=function(e){function g(a){console.log("SVPS | "+a)}function H(){var a=e("."+h.container);if(m.topic)o.topic=e(".topics .topic",a).not(".template").length;if(m.speaker)o.speaker=e(".speakers .speaker",a).not(".template").length}function I(){if(z>0)if(typeof SvpPolling!=="undefined"){var a=z*1E3,b=e("#"+h.data).attr("data-hash");c.player.onPlay(function(){SvpPolling.init(b,J,a)});c.player.onPause(function(){SvpPolling.stop();p("speaker");p("topic")})}else g(i.no_svpp,true);else g(i.svpp_off,
false)}function A(a,b){a=a[a.length-1].id;q[b]!==a&&v(a,b)}function B(a,b){var d=e("."+h.container+" ."+b+"s ."+b).last(),k=d.parent();if(d.hasClass("template")){d.removeClass("template");d.remove();k.removeClass("template")}for(var j=0;j<a.length;j++){var l=d.clone(),r=a[j];switch(b){case "speaker":e(".speaker-avatar",l).attr("src",K+r.photo);e(".speaker-data",l).html(r.firstname+" "+r.lastname);break;case "topic":e(".topic-title",l).html(r.title);e(".topic-description",l).html(r.description)}l.attr("data-"+
b,r.id).removeClass("active");k.append(l);o[b].length++}}function L(a){for(var b in a)if(a.hasOwnProperty(b))s.playlist[a[b].streamfileId]=parseInt(b,10)}function M(){var a=null;if(m.topic){e("."+h.container+" .topics").on("click",".topic .topic-link",function(j){j.preventDefault();c.jumpToTopic(e(this).parent(".topic").attr("data-topic"))});var b=e("#"+h.topicTimeline).first();if(b.exists()){try{a=JSON.parse(b.html())}catch(d){g(i.no_json_support,true);return false}a.length>0&&C("topic",a,true);
b.html("")}g(i.events_topic_init,false)}if(m.speaker){b=e("#"+h.speakerTimeline).first();if(b.exists()){a=null;try{a=JSON.parse(b.html())}catch(k){g(i.no_json_support,true);return false}a.length>0&&C("speaker",a,false);b.html("")}g(i.events_speaker_init,false)}}function C(a,b,d){for(var k=0;k<b.length;k++){var j=b[k],l=k+1;j.start=Math.floor(j.relativeTime/1E3);j.end=l<b.length&&j.streamfileId===b[l].streamfileId?Math.floor(b[l].relativeTime/1E3):Number.MAX_SAFE_INTEGER;if(d)s[a][j.id]={playlist:s.playlist[j.streamfileId],
time:j.start};c.player.onTime(w.onTime(j,a));c.player.onSeek(w.onSeek(j,a))}c.player.onSeek(w.onSeekFinal(a))}function u(){c.jw=jwplayer(h.player);c.jw.onReady(function(){p("speaker");p("topic");N()})}function N(){var a=null;for(a in f.onTime)f.onTime.hasOwnProperty(a)&&c.jw.onTime(f.onTime[a]);for(a in f.onSeek)f.onSeek.hasOwnProperty(a)&&c.jw.onSeek(f.onSeek[a]);for(a in f.onPlay)f.onPlay.hasOwnProperty(a)&&c.jw.onPlay(f.onPlay[a]);for(a in f.onPause)f.onPause.hasOwnProperty(a)&&c.jw.onPause(f.onPause[a]);
g(i.events_re,false)}function p(a){if(m[a]){var b=e("."+h.container+" ."+a+"s");e("."+a+".active",b).removeClass("active");q[a]=0;b.trigger("SVPS:inactive-"+a)}}function v(a,b){var d=e("."+h.container+" ."+b+"s"),k=e("."+b+"[data-"+b+"="+a+"]",d);e("."+b+".active",d).removeClass("active");q[b]=a;k.first().addClass("active");d.trigger("SVPS:active-"+b,{id:a,index:k.index()});g(i.activate+" "+b+" "+a,false)}function D(a,b,d){c.player.playlistNext();a++;a<b?c.jw.onReady(function(){setTimeout(function(){D(a,
b,d)},50)}):x(d)}function E(a,b,d){c.player.playlistPrev();a--;a>b?c.jw.onReady(function(){setTimeout(function(){E(a,b,d)},50)}):x(d)}function x(a){if(c.jw.getState()!=="PLAYING"){O(a);c.jw.play(true)}else c.player.seek(a.time)}function O(a){t.hasOwnProperty(a.playlist)||(t[a.playlist]={});t[a.playlist][a.time]=true;c.jw.onPlay(function(){if(t[a.playlist][a.time]){c.player.seek(a.time);t[a.playlist][a.time]=false}})}function F(a){return s.playlist[a.streamfileId]===c.player.getPlaylistIndex()}function G(){if(typeof jwplayer===
"undefined"){g(i.no_jwplayer,true);return false}jwplayer.key="###JWPLAYER_KEY###";return true}function P(a){if(G(true)){if(typeof smvplayer!=="undefined"){c.player=smvplayer(h.player);c.player.init(a);c.jw=jwplayer(h.player);c.player.onTime=function(b){f.onTime.push(b);c.jw.onTime(b)};c.player.onSeek=function(b){f.onSeek.push(b);c.jw.onSeek(b)};c.player.onPlay=function(b){f.onPlay.push(b);c.jw.onPlay(b)};c.player.onPause=function(b){f.onPause.push(b);c.jw.onPause(b)};n.player.next=c.player.next;c.player.next=
function(){n.player.next();u()};n.player.previous=c.player.previous;c.player.previous=function(){n.player.previous();u()};n.player.setQualityLevel=c.player.setQualityLevel;c.player.setQualityLevel=function(b){n.player.setQualityLevel(b);u()};n.player.setAudioLanguage=c.player.setAudioLanguage;c.player.setAudioLanguage=function(b){n.player.setAudioLanguage(b);u()};c.player.getPlaylistIndex=function(){return c.player.getTimeline().currentItem};c.player.playlistNext=function(){c.player.next()};c.player.playlistPrev=
function(){c.player.previous()};c.player.playlistItem=function(b,d){b=b-c.player.getPlaylistIndex();if(b>0)D(0,b,d);else b<0&&E(0,b,d);return 2};return true}g(i.no_smvplayer,true)}return false}function Q(a){if(G(false)){jwplayer(h.player).setup(a);c.player=jwplayer(h.player);c.jw=c.player;c.player.onPlaylistItem(function(){p("speaker");p("topic")});return true}return false}var K="###SPEAKER_IMAGE_DIR###",z=parseInt("###POLLING_INTERVAL###",10),J=parseInt("###CURRENT_PAGE_ID###",10),R=parseInt("###PLAYER_TYPE###",
10),m={topic:parseInt("###MEETINGDATA_TOPICS###",10),speaker:parseInt("###MEETINGDATA_SPEAKERS###",10)},s={playlist:{},topic:{}},o={topic:0,speaker:0},q={topic:0,speaker:0},n={player:{next:null,previous:null,setQualityLevel:null,setAudioLanguage:null}},f={onTime:[],onSeek:[],onPlay:[],onPause:[]},t={},y={topic:false,speaker:false},w={onTime:function(a,b){return function(d){d.position>=a.start&&d.position<a.start+0.4&&a.id!==q[b]&&F(a)&&v(a.id,b)}},onSeek:function(a,b){return function(d){if(d.offset>=
a.start&&d.offset<a.end&&F(a)){a.id!==q[b]&&v(a.id,b);y[b]=true}}},onSeekFinal:function(a){return function(){!y[a]&&q[a]!==0&&p(a);y[a]=false}}},h={player:"tx-streamovations-vp-play",data:"tx-streamovations-vp-playerdata",topicTimeline:"tx-streamovations-vp-topictimeline",speakerTimeline:"tx-streamovations-vp-speakertimeline",container:"tx-streamovations-vp"},i={no_svpp:"SVPP not loaded, polling inactive",svpp_off:"Polling disabled",no_player_data:"The player element or player data is not available",
no_json_support:"No JSON.parse support in user agent",player_data_invalid:"Player data is invalid or in an unsupported format",invalid_player:"No supported player configured",no_jwplayer:"No jwplayer loaded",no_jwplayer_key:"A jwplayer license key is required",no_smvplayer:"No smvplayer loaded",events_topic_init:"initializing topic event handlers",events_speaker_init:"initializing speaker event handlers",events_re:"Reattached event callbacks",no_timestamp:"Topic has no registered timestamps",activate:"Activated"};
e.fn.exists=function(){return this.length!==0};var c={player:null,jw:null,isLiveStream:false,init:function(){var a=e("#"+h.player),b=e("#"+h.data).first();if(!a.exists()||!b.exists()){g(i.no_player_data,true);return false}var d=null;try{d=JSON.parse(b.html().trim())}catch(k){g(i.no_json_support,true);return false}b.html("");if(typeof d!=="object"){g(i.player_data_invalid,true);return false}switch(R){case 2:if(!P(d))return false;break;case 1:if(!Q(d))return false;break;default:g(i.invalid_player,true);
return false}c.player.onPlay(function(){a.trigger("SVPS:play")});d.hasOwnProperty("playlist")&&L(d.playlist);if(d.hasOwnProperty("application"))this.isLiveStream=d.application==="rtplive";if(this.isLiveStream){if(m.topic||m.speaker){H();I()}}else M();return true},processMeetingdataChange:function(a){if(m.topic){a.hasOwnProperty("topics")&&a.topics!==false&&a.topics.length>o.topic&&B(a.topics.slice(o.topic),"topic");a.hasOwnProperty("topicTimeline")&&a.topicTimeline!==false&&a.topicTimeline.length>
0&&A(a.topicTimeline,"topic")}if(m.speaker){a.hasOwnProperty("speakers")&&a.speakers!==false&&a.speakers.length>o.speaker&&B(a.speakers.slice(o.speaker),"speaker");a.hasOwnProperty("speakerTimeline")&&a.speakerTimeline!==false&&a.speakerTimeline.length>0&&A(a.speakerTimeline,"speaker")}},jumpToTopic:function(a){a=s.topic[a];if(a!==undefined){if(a.playlist!==this.player.getPlaylistIndex())if(this.player.playlistItem(a.playlist,a)===2)return;x(a)}else g(i.no_timestamp,true)}};return c}(jQuery);