/*
 http://www.gnu.org/licenses/gpl.html GNU General Public License, version 3 or later
*/
var SvpStarter=function(g){function h(a){console.log("SVPS | "+a)}function K(){var a=g("."+e.container);if(n.topic)u.topic=g(".topics .topic",a).not(".template").length;if(n.speaker)u.speaker=g(".speakers .speaker",a).not(".template").length}function E(a){if(L>0)if(typeof SvpPolling!=="undefined"){var b=L*1E3,d=g("#"+e.data).attr("data-hash");if(a)SvpPolling.init(d,M,b);else{r(function(){SvpPolling.init(d,M,b)});v(function(){SvpPolling.stop();m("speaker");m("topic")})}}else h(i.no_svpp,true);else h(i.svpp_off,
false)}function X(a){a=a[a.length-1];try{if(a.valid){var b=Math.round((new Date).getTime()/1E3);if(l.eventBreak)a.end!==null&&a.utcEnd<=b&&Y();else if(a.utc<=b)if(a.end===null||a.utcEnd>b)Z()}}catch(d){h(i.invalid_eventbreak,true)}}function Y(){SvpPolling.stop();var a=g("."+e.container+" .video-player-break"),b='<div id="'+e.player+'" class="video-player"></div>';a.parent().append(b);a.remove();l.eventBreak=false;c.init();F()}function Z(){G();f={onTime:[],onSeek:[],onPlay:[],onPause:[]};var a=g("."+
e.container+" #"+e.playerPI).first(),b='<div class="video-player-break"><div class="text"><div class="title">'+i.video_break_title+'</div><div class="sub">'+i.video_break_sub+"</div></div></div>";a.parent().append(b);a.remove();l.eventBreak=true;E(true)}function N(a,b){a=a[a.length-1].id;l[b]!==a&&z(a,b)}function O(a,b){var d=g("."+e.container+" ."+b+"s ."+b).last(),j=d.parent();if(d.hasClass("template")){d.removeClass("template");d.remove();j.removeClass("template")}for(var k=0;k<a.length;k++){var p=
d.clone(),t=a[k];switch(b){case "speaker":g(".speaker-avatar",p).attr("src",$+t.photo);g(".speaker-data",p).html(t.firstname+" "+t.lastname);break;case "topic":g(".topic-title",p).html(t.title);g(".topic-description",p).html(t.description)}p.attr("data-"+b,t.id).removeClass("active");j.append(p);u[b].length++}}function aa(a){var b={};for(var d in a)if(a.hasOwnProperty(d))b[a[d].streamfileId]=parseInt(d,10);return b}function ba(){var a=null;if(n.topic){g("."+e.container+" .topics").on("click",".topic .topic-link",
function(k){k.preventDefault();c.jumpToTopic(g(this).parent(".topic").attr("data-topic"))});var b=g("#"+e.topicTimeline).first();if(b.exists()){try{a=JSON.parse(b.html())}catch(d){h(i.no_json_support,true);return false}a.length>0&&P("topic",a,true);b.html("")}h(i.events_topic_init,false)}if(n.speaker){b=g("#"+e.speakerTimeline).first();if(b.exists()){a=null;try{a=JSON.parse(b.html())}catch(j){h(i.no_json_support,true);return false}a.length>0&&P("speaker",a,false);b.html("")}h(i.events_speaker_init,
false)}}function P(a,b,d){for(var j=0;j<b.length;j++){var k=b[j],p=j+1;k.start=Math.floor(k.relativeTime/1E3);k.end=p<b.length&&k.streamfileId===b[p].streamfileId?Math.floor(b[p].relativeTime/1E3):Number.MAX_SAFE_INTEGER;k.playlist=H(k);if(d)Q[a][k.id]={playlist:k.playlist,time:k.start};x(A.onTime(k,a));w(A.onSeek(k,a))}w(A.onSeekFinal(a))}function ca(){c.player.addEventListener("timeupdate",function(){for(var a in f.onTime)f.onTime.hasOwnProperty(a)&&f.onTime[a]({position:this.currentTime})})}function I(){ca();
c.player.addEventListener("seeking",function(){h("Seeking event fired: time "+this.currentTime);for(var a in f.onSeek)f.onSeek.hasOwnProperty(a)&&f.onSeek[a]({offset:this.currentTime})})}function R(a,b){m("speaker");m("topic");s(a,b);S()}function T(a,b){m("speaker");m("topic");c.player=document.getElementById(e.playerObj);a!==undefined&&s(a,b);I()}function U(a,b){m("speaker");m("topic");c.player=document.getElementById(e.playerObj);a!==undefined&&s(a,b)}function B(){c.jw=jwplayer(e.playerObj);c.jw.onReady(function(){m("speaker");
m("topic");da()})}function ea(){for(var a in f.onTime)f.onTime.hasOwnProperty(a)&&f.onTime[a]()}function da(){var a=null;for(a in f.onTime)f.onTime.hasOwnProperty(a)&&c.jw.onTime(f.onTime[a]);for(a in f.onSeek)f.onSeek.hasOwnProperty(a)&&c.smv.onSeek(f.onSeek[a]);S()}function S(){var a=null;for(a in f.onPlay)f.onPlay.hasOwnProperty(a)&&c.smv.onPlay(f.onPlay[a]);for(a in f.onPause)f.onPause.hasOwnProperty(a)&&c.smv.onPause(f.onPause[a]);h(i.events_re,false)}function m(a){if(n[a]){var b=g("."+e.container+
" ."+a+"s");g("."+a+".active",b).removeClass("active");l[a]=0;b.trigger("SVPS:inactive-"+a)}}function z(a,b){var d=g("."+e.container+" ."+b+"s"),j=g("."+b+"[data-"+b+"="+a+"]",d);g("."+b+".active",d).removeClass("active");l[b]=a;j.first().addClass("active");d.trigger("SVPS:active-"+b,{id:a,index:j.index()});h(i.activate+" "+b+" "+a,false)}function s(a,b){C.hasOwnProperty(b)||(C[b]={});C[b][a]=true;r(function(){if(C[b][a]){q(a,b);C[b][a]=false}})}function V(){if(typeof jwplayer==="undefined"){h(i.no_jwplayer,
true);return false}jwplayer.key="###JWPLAYER_KEY###";return true}function fa(a,b){if(typeof smvplayer!=="undefined"){c.smv=smvplayer(e.player);try{c.smv.init(a,b)}catch(d){h(d,true)}o=function(){return c.smv.getCurrentPlaylistItem().streamfileId};H=function(j){return j.streamfileId};F=function(){c.smv.whenReady(function(){c.smv.play()})};G=function(){c.smv.stop()};a=c.smv.getEngine();if(a==="hlsjs")ga();else if(a==="me")ha();else if(a==="jw")ia();else a==="html5"&&ja();e.playerPI=e.smvWrapper1+e.player;
return true}h(i.no_smvplayer,true);return false}function ia(){c.player=c.smv;e.playerObj=e.smvWrapper1+e.smvWrapper2+e.player;c.jw=jwplayer(e.playerObj);x=function(b){f.onTime.push(b);c.jw.onTime(b)};w=function(b){f.onSeek.push(b);c.smv.onSeek(b)};r=function(b){f.onPlay.push(b);c.smv.onPlay(b)};v=function(b){f.onPause.push(b);c.smv.onPause(b)};var a={};a.next=c.smv.next;c.smv.next=function(){a.next();B()};a.previous=c.smv.previous;c.smv.previous=function(){a.previous();B()};a.setQualityLevel=c.smv.setQualityLevel;
c.smv.setQualityLevel=function(b){a.setQualityLevel(b);B()};a.setAudioLanguage=c.smv.setAudioLanguage;c.smv.setAudioLanguage=function(b){a.setAudioLanguage(b);B()};y=function(b){var d=c.smv.getStatus();if(d!=="PLAYING"&&d!=="IDLE"){s(b.time,b.playlist);c.smv.play()}else q(b.time,b.playlist)};q=function(b,d){if(d===o())d=null;c.smv.seek(b,d);d!==null&&B()}}function ga(){e.playerObj=e.hlsWrapper+e.player;c.player=document.getElementById(e.playerObj);c.smv.onReload(function(){T()});I();x=function(a){f.onTime.push(a)};
w=function(a){f.onSeek.push(a)};r=function(a){c.smv.onPlay(a)};v=function(a){c.smv.onPause(a)};y=function(a){var b=c.smv.getStatus().toUpperCase();if(b!=="PLAYING"&&b!=="IDLE"){s(a.time,a.playlist);c.smv.play()}else q(a.time,a.playlist)};q=function(a,b){if(b===o())b=null;c.smv.seek(a,b);b!==null&&T(a,b)}}function ha(){e.playerObj=e.hlsWrapper+e.player;c.player=document.getElementById(e.playerObj);c.smv.onReload(function(){U()});x=function(a){f.onTime.push(a)};w=function(a){c.smv.onSeek(a)};r=function(a){c.smv.onPlay(a)};
v=function(a){c.smv.onPause(a)};A.onSeek=function(a,b){return function(){var d=c.smv.getPosition();if(d>=a.start&&d<a.end&&a.playlist===o()){a.id!==l[b]&&z(a.id,b);D[b]=true}}};A.onTime=function(a,b){return function(){var d=c.smv.getPosition();d>=a.start&&d<a.start+0.4&&a.id!==l[b]&&a.playlist===o()&&z(a.id,b)}};r(function(){if(l.pausePlayInterval===null)l.pausePlayInterval=setInterval(ea,400)});v(function(){l.pausePlayInterval!==null&&clearInterval(l.pausePlayInterval);l.pausePlayInterval=null});
y=function(a){var b=c.smv.getStatus().toUpperCase();if(b!=="PLAYING"&&b!=="IDLE"){s(a.time,a.playlist);c.smv.play()}else q(a.time,a.playlist)};q=function(a,b){if(b===o())b=null;c.smv.seek(a,b);b!==null&&U(a,b)}}function ja(){e.playerObj=e.player+e.html5Wrapper;c.player=document.getElementById(e.playerObj);I();x=function(b){f.onTime.push(b)};w=function(b){f.onSeek.push(b)};r=function(b){f.onPlay.push(b);c.smv.onPlay(b)};v=function(b){f.onPause.push(b);c.smv.onPause(b)};var a={};a.setQualityLevel=c.smv.setQualityLevel;
c.smv.setQualityLevel=function(b){var d=c.player.currentTime,j=o();a.setQualityLevel(b);R(d,j)};a.setAudioLanguage=c.smv.setAudioLanguage;c.smv.setAudioLanguage=function(b){var d=c.player.currentTime,j=o();a.setAudioLanguage(b);R(d,j)};c.smv.onComplete(function(){m("speaker");m("topic")});y=function(b){var d=b.playlist===o()?null:b.playlist;if(c.smv.getStatus()==="PLAYING")q(b.time,d);else if(d===null){s(b.time,null);c.smv.play()}else h(i.no_playlist_seek,true)};q=function(b,d){c.smv.seek(b,d)}}function W(a){jwplayer(e.player).setup(a);
c.jw=jwplayer(e.player);c.player=c.jw;x=function(d){c.jw.onTime(d)};w=function(d){c.jw.onSeek(d)};r=function(d){c.jw.onPlay(d)};v=function(d){c.jw.onPause(d)};o=function(){return c.jw.getPlaylistIndex()};F=function(){c.jw.onReady(function(){c.jw.play()})};G=function(){c.jw.stop()};c.jw.onPlaylistItem(function(){m("speaker");m("topic")});y=function(d){if(c.jw.getState().toUpperCase()!=="PLAYING"){s(d.time,d.playlist);c.jw.play()}else q(d.time,d.playlist)};if(a.hasOwnProperty("playlist")){var b=aa(a.playlist);
H=function(d){return b[d.streamfileId]}}else{h(i.no_playlist,true);n.topic=false;n.speaker=false}}function ka(a){if(V(true)){W(a);q=function(b,d){if(o()!==d){c.jw.once("playlistItem",function(){c.jw.once("play",function(){c.jw.seek(b)})});c.jw.playlistItem(d)}else c.jw.seek(b)};s=function(b,d){c.jw.once("play",function(){q(b,d)})};return true}return false}function la(a){if(V(false)){W(a);q=function(b,d){if(o()!==d){J[d]=true;c.jw.onPlaylistItem(function(){if(J[d]){c.jw.seek(b);J[d]=false}});c.jw.playlistItem(d)}else c.jw.seek(b)};
return true}return false}var $="###SPEAKER_IMAGE_DIR###",L=parseInt("###POLLING_INTERVAL###",10),M=parseInt("###CURRENT_PAGE_ID###",10),ma=parseInt("###PLAYER_TYPE###",10),n={breaks:parseInt("###MEETINGDATA_BREAKS###",10),topic:parseInt("###MEETINGDATA_TOPICS###",10),speaker:parseInt("###MEETINGDATA_SPEAKERS###",10)},Q={topic:{}},u={topic:0,speaker:0},l={topic:0,speaker:0,eventBreak:false,pausePlayInterval:null},f={onTime:[],onSeek:[],onPlay:[],onPause:[]},C={},J={},D={topic:false,speaker:false},
A={onTime:function(a,b){return function(d){d.position>=a.start&&d.position<a.start+0.4&&a.id!==l[b]&&a.playlist===o()&&z(a.id,b)}},onSeek:function(a,b){return function(d){if(d.offset>=a.start&&d.offset<a.end&&a.playlist===o()){a.id!==l[b]&&z(a.id,b);D[b]=true}}},onSeekFinal:function(a){return function(){!D[a]&&l[a]!==0&&m(a);D[a]=false}}},e={player:"tx-streamovations-vp-play",playerObj:"tx-streamovations-vp-play",playerPI:"tx-streamovations-vp-play",playerContainer:"video-player-container",smvWrapper1:"smvplayer_",
smvWrapper2:"engineWrapper_",hlsWrapper:"smv_html5videotag_",html5Wrapper:"_html5videotag",data:"tx-streamovations-vp-playerdata",config:"tx-streamovations-vp-playerconfig",topicTimeline:"tx-streamovations-vp-topictimeline",speakerTimeline:"tx-streamovations-vp-speakertimeline",container:"tx-streamovations-vp"},i={no_svpp:"SVPP not loaded, polling inactive",svpp_off:"Polling disabled",no_player_data:"The player element or player data is not available",no_playlist:"Missing essential playlist data",
no_json_support:"No JSON.parse support in user agent",player_data_invalid:"Player data is invalid or in an unsupported format",invalid_player:"No supported player configured",invalid_eventbreak:"Eventbreak data is invalid or in an unsupported format",no_jwplayer:"No jwplayer loaded",no_jwplayer_key:"A jwplayer license key is required",no_smvplayer:"No smvplayer loaded",events_topic_init:"initializing topic event handlers",events_speaker_init:"initializing speaker event handlers",events_re:"Reattached event callbacks",
no_timestamp:"Topic has no registered timestamps",no_playlist_seek:"Can only seek to other playlist item during playback",activate:"Activated",video_break_title:"###VIDEO_BREAK_TITLE###",video_break_sub:"###VIDEO_BREAK_SUB###"};g.fn.exists=function(){return this.length!==0};var w=null,x=null,r=null,v=null,o=null,H=null,y=null,q=null,G=null,F=null,c={player:null,jw:null,smv:null,isLiveStream:false,init:function(){var a=g("."+e.playerContainer),b=g("#"+e.data).first();if(!a.exists()||!b.exists()){h(i.no_player_data,
true);return false}var d=null,j=null;try{d=JSON.parse(b.html().trim())}catch(k){h(i.no_json_support,true);return false}if(typeof d!=="object"){h(i.player_data_invalid,true);return false}if(d.hasOwnProperty("application"))this.isLiveStream=d.application==="rtplive";if(g("#"+e.player,a).exists())try{switch(ma){case 3:var p=g("#"+e.config).first();if(p.exists())j=JSON.parse(p.html().trim());if(!fa(d,j))return false;break;case 2:if(!ka(d))return false;break;case 1:if(!la(d))return false;break;default:h(i.invalid_player,
true);return false}r(function(){a.trigger("SVPS:play")});if(this.isLiveStream){if(n.topic||n.speaker||n.breaks){K();E(false)}}else ba()}catch(t){h(t,true)}else if(this.isLiveStream&&n.breaks){l.eventBreak=true;K();E(true)}return true},processMeetingdataChange:function(a){if(n.topic){a.hasOwnProperty("topics")&&a.topics!==false&&a.topics.length>u.topic&&O(a.topics.slice(u.topic),"topic");a.hasOwnProperty("topicTimeline")&&a.topicTimeline!==false&&a.topicTimeline.length>0&&N(a.topicTimeline,"topic")}if(n.speaker){a.hasOwnProperty("speakers")&&
a.speakers!==false&&a.speakers.length>u.speaker&&O(a.speakers.slice(u.speaker),"speaker");a.hasOwnProperty("speakerTimeline")&&a.speakerTimeline!==false&&a.speakerTimeline.length>0&&N(a.speakerTimeline,"speaker")}n.breaks&&a.hasOwnProperty("eventBreaks")&&a.eventBreaks!==false&&a.eventBreaks.length>0&&X(a.eventBreaks)},jumpToTopic:function(a){a=Q.topic[a];a!==undefined?y(a):h(i.no_timestamp,true)}};return c}(jQuery);