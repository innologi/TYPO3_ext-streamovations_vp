/*
 http://www.gnu.org/licenses/gpl.html GNU General Public License, version 3 or later
*/
var SvpStarter=function(h){function j(a,b){a=i.engine+" | "+a;console.log("SVPS | "+a);if(b){if(D===null){b=h("."+e.container);b.prepend('<ul class="typo3-messages"><li class="alert alert-danger"><h4 class="alert-title">Error</h4></li></ul>');D=h(".typo3-messages .alert",b)}D.html(D.html()+'<p class="alert-message">'+a+"</p>")}}function L(){var a=h("."+e.container);if(n.topic)t.topic=h(".topics .topic",a).not(".template").length;if(n.speaker)t.speaker=h(".speakers .speaker",a).not(".template").length}
function F(a){if(M>0)if(typeof SvpPolling!=="undefined"){var b=M*1E3,d=h("#"+e.data).attr("data-hash");if(a)SvpPolling.init(d,N,b);else{s(function(){SvpPolling.init(d,N,b)});v(function(){SvpPolling.stop();p("speaker");p("topic")})}}else j(k.no_svpp,true);else j(k.svpp_off,false)}function W(a){a=a[a.length-1];try{if(a.valid){var b=Math.round((new Date).getTime()/1E3);if(i.eventBreak)a.end!==null&&a.utcEnd<=b&&X();else if(a.utc<=b)if(a.end===null||a.utcEnd>b)Y()}}catch(d){j(k.invalid_eventbreak,true)}}
function X(){SvpPolling.stop();var a=h("."+e.container+" .video-player-break"),b='<div id="'+e.player+'" class="video-player"></div>';a.parent().append(b);a.remove();i.eventBreak=false;c.init();G()}function Y(){H();f={onTime:[],onSeek:[],onPlay:[],onPause:[]};var a=h("."+e.container+" #"+e.playerPI).first(),b='<div class="video-player-break"><div class="text"><div class="title">'+k.video_break_title+'</div><div class="sub">'+k.video_break_sub+"</div></div></div>";a.parent().append(b);a.remove();i.eventBreak=
true;F(true)}function O(a,b){a=a[a.length-1].id;i[b]!==a&&x(a,b)}function P(a,b){var d=h("."+e.container+" ."+b+"s ."+b).last(),g=d.parent();if(d.hasClass("template")){d.removeClass("template");d.remove();g.removeClass("template")}for(var m=0;m<a.length;m++){var l=d.clone(),o=a[m];switch(b){case "speaker":h(".speaker-avatar",l).attr("src",Z+o.photo);h(".speaker-data",l).html(o.firstname+" "+o.lastname);break;case "topic":h(".topic-title",l).html(o.title);h(".topic-description",l).html(o.description)}l.attr("data-"+
b,o.id).removeClass("active");g.append(l);t[b].length++}}function $(a){var b={};for(var d in a)if(a.hasOwnProperty(d))b[a[d].streamfileId]=parseInt(d,10);return b}function aa(){var a=null;if(n.topic){var b=h("."+e.container+" .topics");b.on("click",".topic .topic-link",function(l){l.preventDefault();c.jumpToTopic(h(this).parent(".topic").attr("data-topic"))});var d=h("#"+e.topicTimeline).first();if(d.exists()){try{a=JSON.parse(d.html())}catch(g){j(k.no_json_support,true);return false}a.length>0&&
Q("topic",a,true);d.html("")}b.find(".topic").each(function(l,o){l=h(o);if(I.topic[l.attr("data-topic")]===undefined){o=l.find(".topic-link");if(o[0]){var ba=o.text();l.append('<span class="topic-title">'+ba+"</span>");o.remove()}}});j(k.events_topic_init,false)}if(n.speaker){b=h("#"+e.speakerTimeline).first();if(b.exists()){a=null;try{a=JSON.parse(b.html())}catch(m){j(k.no_json_support,true);return false}a.length>0&&Q("speaker",a,false);b.html("")}j(k.events_speaker_init,false)}}function Q(a,b,d){for(var g=
0;g<b.length;g++){var m=b[g],l=g+1;m.start=Math.floor(m.relativeTime/1E3);m.end=l<b.length&&m.streamfileId===b[l].streamfileId?Math.floor(b[l].relativeTime/1E3):Number.MAX_SAFE_INTEGER;m.playlist=J(m);if(d)I[a][m.id]={playlist:m.playlist,time:m.start};y(z.onTime(m,a));w(z.onSeek(m,a))}w(z.onSeekFinal(a))}function ca(){c.player.addEventListener("timeupdate",function(){for(var a in f.onTime)f.onTime.hasOwnProperty(a)&&f.onTime[a]({position:this.currentTime})})}function R(){ca();c.player.addEventListener("seeking",
function(){j("Seeking event fired: time "+this.currentTime);for(var a in f.onSeek)f.onSeek.hasOwnProperty(a)&&f.onSeek[a]({offset:this.currentTime})})}function S(a,b){p("speaker");p("topic");c.player=document.getElementById(e.playerObj);a!==undefined&&u(a,b);R()}function T(a,b){p("speaker");p("topic");c.player=document.getElementById(e.playerObj);a!==undefined&&u(a,b)}function A(){c.jw=jwplayer(e.playerObj);c.jw.onReady(function(){p("speaker");p("topic");da()})}function ea(){for(var a in f.onTime)f.onTime.hasOwnProperty(a)&&
f.onTime[a]()}function da(){var a=null;for(a in f.onTime)f.onTime.hasOwnProperty(a)&&c.jw.onTime(f.onTime[a]);for(a in f.onSeek)f.onSeek.hasOwnProperty(a)&&c.smv.onSeek(f.onSeek[a]);fa()}function fa(){var a=null;for(a in f.onPlay)f.onPlay.hasOwnProperty(a)&&c.smv.onPlay(f.onPlay[a]);for(a in f.onPause)f.onPause.hasOwnProperty(a)&&c.smv.onPause(f.onPause[a]);j(k.events_re,false)}function p(a){if(n[a]){var b=h("."+e.container+" ."+a+"s");h("."+a+".active",b).removeClass("active");i[a]=0;b.trigger("SVPS:inactive-"+
a)}}function x(a,b){var d=h("."+e.container+" ."+b+"s"),g=h("."+b+"[data-"+b+"="+a+"]",d);h("."+b+".active",d).removeClass("active");i[b]=a;g.first().addClass("active");d.trigger("SVPS:active-"+b,{id:a,index:g.index()});j(k.activate+" "+b+" "+a,false)}function u(a,b){B.hasOwnProperty(b)||(B[b]={});B[b][a]=true;s(function(){if(B[b][a]){q(a,b);B[b][a]=false}})}function U(a,b){i.engine="jw:";if(typeof jwplayer==="undefined"){j(k.no_jwplayer,true);return false}if(b!==null&&b.key)jwplayer.key=b.key;else if(a){j(k.no_jwplayer_key,
true);return false}return true}function ga(a,b){if(typeof smvplayer!=="undefined"){i.engine="smv:";c.smv=smvplayer(e.player);try{c.smv.init(a,b)}catch(d){j(d,true)}r=function(){return c.smv.getCurrentPlaylistItem().streamfileId};J=function(g){return g.streamfileId};G=function(){c.smv.whenReady(function(){c.smv.play()})};H=function(){c.smv.stop()};a=c.smv.getEngine();i.engine+=a;if(a==="hlsjs"||a==="html5")ha();else if(a==="me")ia();else a==="jw"&&ja();e.playerPI=e.smvWrapper1+e.player;return true}j(k.no_smvplayer,
true);return false}function ja(){c.player=c.smv;e.playerObj=e.smvWrapper1+e.smvWrapper2+e.player;c.jw=jwplayer(e.playerObj);y=function(b){f.onTime.push(b);c.jw.onTime(b)};w=function(b){f.onSeek.push(b);c.smv.onSeek(b)};s=function(b){f.onPlay.push(b);c.smv.onPlay(b)};v=function(b){f.onPause.push(b);c.smv.onPause(b)};var a={};a.next=c.smv.next;c.smv.next=function(){a.next();A()};a.previous=c.smv.previous;c.smv.previous=function(){a.previous();A()};a.setQualityLevel=c.smv.setQualityLevel;c.smv.setQualityLevel=
function(b){a.setQualityLevel(b);A()};a.setAudioLanguage=c.smv.setAudioLanguage;c.smv.setAudioLanguage=function(b){a.setAudioLanguage(b);A()};C=function(b){var d=c.smv.getStatus();if(d!=="PLAYING"&&d!=="IDLE"){u(b.time,b.playlist);c.smv.play()}else q(b.time,b.playlist)};q=function(b,d){if(d===r())d=null;c.smv.seek(b,d);d!==null&&A()}}function ha(){e.playerObj=e.hlsWrapper+e.player;c.player=document.getElementById(e.playerObj);c.smv.onReload(function(){S()});R();y=function(a){f.onTime.push(a)};w=function(a){f.onSeek.push(a)};
s=function(a){c.smv.onPlay(a)};v=function(a){c.smv.onPause(a)};C=function(a){var b=c.smv.getStatus().toUpperCase();b!=="PLAYING"&&b!=="IDLE"?u(a.time,a.playlist):q(a.time,a.playlist);c.smv.play()};q=function(a,b){if(b===r())b=null;c.smv.seek(a,b);b!==null&&S(a,b)}}function ia(){e.playerObj=e.hlsWrapper+e.player;c.player=document.getElementById(e.playerObj);c.smv.onReload(function(){T()});y=function(a){f.onTime.push(a)};w=function(a){c.smv.onSeek(a)};s=function(a){c.smv.onPlay(a)};v=function(a){c.smv.onPause(a)};
z.onSeek=function(a,b){return function(){var d=c.smv.getPosition();if(d>=a.start&&d<a.end&&a.playlist===r()){a.id!==i[b]&&x(a.id,b);E[b]=true}}};z.onTime=function(a,b){return function(){var d=c.smv.getPosition();d>=a.start&&d<a.start+0.4&&a.id!==i[b]&&a.playlist===r()&&x(a.id,b)}};s(function(){if(i.pausePlayInterval===null)i.pausePlayInterval=setInterval(ea,400)});v(function(){i.pausePlayInterval!==null&&clearInterval(i.pausePlayInterval);i.pausePlayInterval=null});C=function(a){var b=c.smv.getStatus().toUpperCase();
if(b!=="PLAYING"&&b!=="IDLE"){u(a.time,a.playlist);c.smv.play()}else q(a.time,a.playlist)};q=function(a,b){if(b===r())b=null;c.smv.seek(a,b);b!==null&&T(a,b)}}function V(a){jwplayer(e.player).setup(a);c.jw=jwplayer(e.player);c.player=c.jw;y=function(d){c.jw.onTime(d)};w=function(d){c.jw.onSeek(d)};s=function(d){c.jw.onPlay(d)};v=function(d){c.jw.onPause(d)};r=function(){return c.jw.getPlaylistIndex()};G=function(){c.jw.onReady(function(){c.jw.play()})};H=function(){c.jw.stop()};c.jw.onPlaylistItem(function(){p("speaker");
p("topic")});C=function(d){if(c.jw.getState().toUpperCase()!=="PLAYING"){u(d.time,d.playlist);c.jw.play()}else q(d.time,d.playlist)};if(a.hasOwnProperty("playlist")){var b=$(a.playlist);J=function(d){return b[d.streamfileId]}}else{j(k.no_playlist,true);n.topic=false;n.speaker=false}}function ka(a,b){if(U(true,b)){V(a);i.engine+="7";q=function(d,g){if(r()!==g){c.jw.once("playlistItem",function(){c.jw.once("play",function(){c.jw.seek(d)})});c.jw.playlistItem(g)}else c.jw.seek(d)};u=function(d,g){c.jw.once("play",
function(){q(d,g)})};return true}return false}function la(a,b){if(U(false,b)){V(a);i.engine+="6";q=function(d,g){if(r()!==g){K[g]=true;c.jw.onPlaylistItem(function(){if(K[g]){c.jw.seek(d);K[g]=false}});c.jw.playlistItem(g)}else c.jw.seek(d)};return true}return false}var Z="###SPEAKER_IMAGE_DIR###",M=parseInt("###POLLING_INTERVAL###",10),N=parseInt("###CURRENT_PAGE_ID###",10),ma=parseInt("###PLAYER_TYPE###",10),n={breaks:parseInt("###MEETINGDATA_BREAKS###",10),topic:parseInt("###MEETINGDATA_TOPICS###",
10),speaker:parseInt("###MEETINGDATA_SPEAKERS###",10)},I={topic:{}},t={topic:0,speaker:0},i={topic:0,speaker:0,eventBreak:false,pausePlayInterval:null,engine:""},f={onTime:[],onSeek:[],onPlay:[],onPause:[]},B={},K={},E={topic:false,speaker:false},D=null,z={onTime:function(a,b){return function(d){d.position>=a.start&&d.position<a.start+0.4&&a.id!==i[b]&&a.playlist===r()&&x(a.id,b)}},onSeek:function(a,b){return function(d){if(d.offset>=a.start&&d.offset<a.end&&a.playlist===r()){a.id!==i[b]&&x(a.id,
b);E[b]=true}}},onSeekFinal:function(a){return function(){!E[a]&&i[a]!==0&&p(a);E[a]=false}}},e={player:"tx-streamovations-vp-play",playerObj:"tx-streamovations-vp-play",playerPI:"tx-streamovations-vp-play",playerContainer:"video-player-container",smvWrapper1:"smvplayer_",smvWrapper2:"engineWrapper_",hlsWrapper:"smv_html5videotag_",html5Wrapper:"_html5videotag",data:"tx-streamovations-vp-playerdata",config:"tx-streamovations-vp-playerconfig",topicTimeline:"tx-streamovations-vp-topictimeline",speakerTimeline:"tx-streamovations-vp-speakertimeline",
container:"tx-streamovations-vp"},k={no_svpp:"SVPP not loaded, polling inactive",svpp_off:"Polling disabled",no_player_data:"The player element or player data is not available",no_playlist:"Missing essential playlist data",no_json_support:"No JSON.parse support in user agent",player_data_invalid:"Player data is invalid or in an unsupported format",invalid_player:"No supported player configured",invalid_eventbreak:"Eventbreak data is invalid or in an unsupported format",no_jwplayer:"No jwplayer loaded",
no_jwplayer_key:"A jwplayer license key is required",no_smvplayer:"No smvplayer loaded",events_topic_init:"initializing topic event handlers",events_speaker_init:"initializing speaker event handlers",events_re:"Reattached event callbacks",no_timestamp:"Topic has no registered timestamps",no_playlist_seek:"Can only seek to other playlist item during playback",activate:"Activated",video_break_title:"###VIDEO_BREAK_TITLE###",video_break_sub:"###VIDEO_BREAK_SUB###"};h.fn.exists=function(){return this.length!==
0};var w=null,y=null,s=null,v=null,r=null,J=null,C=null,q=null,H=null,G=null,c={player:null,jw:null,smv:null,isLiveStream:false,init:function(){var a=h("."+e.playerContainer),b=h("#"+e.data).first();if(!a.exists()||!b.exists()){j(k.no_player_data,true);return false}var d=null,g=null;try{d=JSON.parse(b.html().trim())}catch(m){j(k.no_json_support,true);return false}if(typeof d!=="object"){j(k.player_data_invalid,true);return false}if(d.hasOwnProperty("application"))this.isLiveStream=d.application===
"rtplive";if(h("#"+e.player,a).exists())try{var l=h("#"+e.config).first();if(l.exists())g=JSON.parse(l.html().trim());switch(ma){case 3:if(!ga(d,g))return false;break;case 2:if(!ka(d,g))return false;break;case 1:if(!la(d,g))return false;break;default:j(k.invalid_player,true);return false}s(function(){a.trigger("SVPS:play")});if(this.isLiveStream){if(n.topic||n.speaker||n.breaks){L();F(false)}}else aa()}catch(o){j(o,true)}else if(this.isLiveStream&&n.breaks){i.eventBreak=true;L();F(true)}return true},
processMeetingdataChange:function(a){if(n.topic){a.hasOwnProperty("topics")&&a.topics!==false&&a.topics.length>t.topic&&P(a.topics.slice(t.topic),"topic");a.hasOwnProperty("topicTimeline")&&a.topicTimeline!==false&&a.topicTimeline.length>0&&O(a.topicTimeline,"topic")}if(n.speaker){a.hasOwnProperty("speakers")&&a.speakers!==false&&a.speakers.length>t.speaker&&P(a.speakers.slice(t.speaker),"speaker");a.hasOwnProperty("speakerTimeline")&&a.speakerTimeline!==false&&a.speakerTimeline.length>0&&O(a.speakerTimeline,
"speaker")}n.breaks&&a.hasOwnProperty("eventBreaks")&&a.eventBreaks!==false&&a.eventBreaks.length>0&&W(a.eventBreaks)},jumpToTopic:function(a){a=I.topic[a];a!==undefined?C(a):j(k.no_timestamp,true)}};return c}(jQuery);