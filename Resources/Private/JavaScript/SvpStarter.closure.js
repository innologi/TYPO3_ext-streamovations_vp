/*
 http://www.gnu.org/licenses/gpl.html GNU General Public License, version 3 or later
*/
var SvpStarter=function(f){function h(a){console.log("SVPS | "+a)}function P(){var a=f("."+g.container);if(l.topic)r.topic=f(".topics .topic",a).not(".template").length;if(l.speaker)r.speaker=f(".speakers .speaker",a).not(".template").length}function Q(){if(H>0)if(typeof SvpPolling!=="undefined"){var a=H*1E3,b=f("#"+g.data).attr("data-hash");s(function(){SvpPolling.init(b,R,a)});y(function(){SvpPolling.stop();m("speaker");m("topic")})}else h(i.no_svpp,true);else h(i.svpp_off,false)}function S(a){a=
a[a.length-1];if(a.valid){var b=Math.round((new Date).getTime()/1E3);if(p.eventBreak)a.utcEnd!==null&&a.utcEnd<=b&&T();else if(a.utc<b)if(a.utcEnd===null||a.utcEnd>b)U()}}function T(){p.eventBreak=false}function U(){d.jw.remove();p.eventBreak=true}function I(a,b){a=a[a.length-1].id;p[b]!==a&&B(a,b)}function J(a,b){var c=f("."+g.container+" ."+b+"s ."+b).last(),k=c.parent();if(c.hasClass("template")){c.removeClass("template");c.remove();k.removeClass("template")}for(var j=0;j<a.length;j++){var n=c.clone(),
t=a[j];switch(b){case "speaker":f(".speaker-avatar",n).attr("src",V+t.photo);f(".speaker-data",n).html(t.firstname+" "+t.lastname);break;case "topic":f(".topic-title",n).html(t.title);f(".topic-description",n).html(t.description)}n.attr("data-"+b,t.id).removeClass("active");k.append(n);r[b].length++}}function W(a){var b={};for(var c in a)if(a.hasOwnProperty(c))b[a[c].streamfileId]=parseInt(c,10);return b}function X(){var a=null;if(l.topic){f("."+g.container+" .topics").on("click",".topic .topic-link",
function(j){j.preventDefault();d.jumpToTopic(f(this).parent(".topic").attr("data-topic"))});var b=f("#"+g.topicTimeline).first();if(b.exists()){try{a=JSON.parse(b.html())}catch(c){h(i.no_json_support,true);return false}a.length>0&&K("topic",a,true);b.html("")}h(i.events_topic_init,false)}if(l.speaker){b=f("#"+g.speakerTimeline).first();if(b.exists()){a=null;try{a=JSON.parse(b.html())}catch(k){h(i.no_json_support,true);return false}a.length>0&&K("speaker",a,false);b.html("")}h(i.events_speaker_init,
false)}}function K(a,b,c){for(var k=0;k<b.length;k++){var j=b[k],n=k+1;j.start=Math.floor(j.relativeTime/1E3);j.end=n<b.length&&j.streamfileId===b[n].streamfileId?Math.floor(b[n].relativeTime/1E3):Number.MAX_SAFE_INTEGER;j.playlist=C(j);if(c)L[a][j.id]={playlist:j.playlist,time:j.start};z(D.onTime(j,a));u(D.onSeek(j,a))}u(D.onSeekFinal(a))}function M(a,b){m("speaker");m("topic");v(a,b);N()}function w(){d.jw=jwplayer(g.player);d.jw.onReady(function(){m("speaker");m("topic");Y()})}function Y(){var a=
null;for(a in e.onTime)e.onTime.hasOwnProperty(a)&&d.jw.onTime(e.onTime[a]);for(a in e.onSeek)e.onSeek.hasOwnProperty(a)&&d.smv.onSeek(e.onSeek[a]);N()}function N(){var a=null;for(a in e.onPlay)e.onPlay.hasOwnProperty(a)&&d.smv.onPlay(e.onPlay[a]);for(a in e.onPause)e.onPause.hasOwnProperty(a)&&d.smv.onPause(e.onPause[a]);h(i.events_re,false)}function m(a){if(l[a]){var b=f("."+g.container+" ."+a+"s");f("."+a+".active",b).removeClass("active");p[a]=0;b.trigger("SVPS:inactive-"+a)}}function B(a,b){var c=
f("."+g.container+" ."+b+"s"),k=f("."+b+"[data-"+b+"="+a+"]",c);f("."+b+".active",c).removeClass("active");p[b]=a;k.first().addClass("active");c.trigger("SVPS:active-"+b,{id:a,index:k.index()});h(i.activate+" "+b+" "+a,false)}function v(a,b){x.hasOwnProperty(b)||(x[b]={});x[b][a]=true;s(function(){if(x[b][a]){q(a,b);x[b][a]=false}})}function E(){if(typeof jwplayer==="undefined"){h(i.no_jwplayer,true);return false}jwplayer.key="###JWPLAYER_KEY###";return true}function Z(a){if(E(false)){if(typeof smvplayer!==
"undefined"){d.smv=smvplayer(g.player);d.smv.init(a);o=function(){return d.smv.getCurrentPlaylistItem().streamfileId};C=function(b){return b.streamfileId};a=d.smv.getEngine();if(a==="jw")$();else a==="html5"&&aa();return true}h(i.no_smvplayer,true)}return false}function $(){d.player=d.smv;g.player=g.smvWrapper+g.player;d.jw=jwplayer(g.player);z=function(b){e.onTime.push(b);d.jw.onTime(b)};u=function(b){e.onSeek.push(b);d.smv.onSeek(b)};s=function(b){e.onPlay.push(b);d.smv.onPlay(b)};y=function(b){e.onPause.push(b);
d.smv.onPause(b)};var a={};a.next=d.smv.next;d.smv.next=function(){a.next();w()};a.previous=d.smv.previous;d.smv.previous=function(){a.previous();w()};a.setQualityLevel=d.smv.setQualityLevel;d.smv.setQualityLevel=function(b){a.setQualityLevel(b);w()};a.setAudioLanguage=d.smv.setAudioLanguage;d.smv.setAudioLanguage=function(b){a.setAudioLanguage(b);w()};A=function(b){var c=d.smv.getStatus();if(c!=="PLAYING"&&c!=="IDLE"){v(b.time,b.playlist);d.smv.play()}else q(b.time,b.playlist)};q=function(b,c){if(c===
o())c=null;d.smv.seek(b,c);c!==null&&w()}}function aa(){g.player+=g.html5Wrapper;d.player=document.getElementById(g.player);d.player.addEventListener("timeupdate",function(){for(var b in e.onTime)e.onTime.hasOwnProperty(b)&&e.onTime[b]({position:this.currentTime})});d.player.addEventListener("seeking",function(){h("Seeking event fired: time "+this.currentTime);for(var b in e.onSeek)e.onSeek.hasOwnProperty(b)&&e.onSeek[b]({offset:this.currentTime})});z=function(b){e.onTime.push(b)};u=function(b){e.onSeek.push(b)};
s=function(b){e.onPlay.push(b);d.smv.onPlay(b)};y=function(b){e.onPause.push(b);d.smv.onPause(b)};var a={};a.setQualityLevel=d.smv.setQualityLevel;d.smv.setQualityLevel=function(b){var c=d.player.currentTime,k=o();a.setQualityLevel(b);M(c,k)};a.setAudioLanguage=d.smv.setAudioLanguage;d.smv.setAudioLanguage=function(b){var c=d.player.currentTime,k=o();a.setAudioLanguage(b);M(c,k)};d.smv.onComplete(function(){m("speaker");m("topic")});A=function(b){var c=b.playlist===o()?null:b.playlist;if(d.smv.getStatus()===
"PLAYING")q(b.time,c);else if(c===null){v(b.time,null);d.smv.play()}else h(i.no_playlist_seek,true)};q=function(b,c){d.smv.seek(b,c)}}function O(a){jwplayer(g.player).setup(a);d.jw=jwplayer(g.player);d.player=d.jw;z=function(c){d.jw.onTime(c)};u=function(c){d.jw.onSeek(c)};s=function(c){d.jw.onPlay(c)};y=function(c){d.jw.onPause(c)};o=function(){return d.jw.getPlaylistIndex()};d.jw.onPlaylistItem(function(){m("speaker");m("topic")});A=function(c){if(d.jw.getState().toUpperCase()!=="PLAYING"){v(c.time,
c.playlist);d.jw.play()}else q(c.time,c.playlist)};if(a.hasOwnProperty("playlist")){var b=W(a.playlist);C=function(c){return b[c.streamfileId]}}else{h(i.no_playlist,true);l.topic=false;l.speaker=false}}function ba(a){if(E(true)){O(a);q=function(b,c){if(o()!==c){d.jw.once("playlistItem",function(){d.jw.once("play",function(){d.jw.seek(b)})});d.jw.playlistItem(c)}else d.jw.seek(b)};v=function(b,c){d.jw.once("play",function(){q(b,c)})};return true}return false}function ca(a){if(E(false)){O(a);q=function(b,
c){if(o()!==c){F[c]=true;d.jw.onPlaylistItem(function(){if(F[c]){d.jw.seek(b);F[c]=false}});d.jw.playlistItem(c)}else d.jw.seek(b)};return true}return false}var V="###SPEAKER_IMAGE_DIR###",H=parseInt("###POLLING_INTERVAL###",10),R=parseInt("###CURRENT_PAGE_ID###",10),da=parseInt("###PLAYER_TYPE###",10),l={breaks:parseInt("###MEETINGDATA_BREAKS###",10),topic:parseInt("###MEETINGDATA_TOPICS###",10),speaker:parseInt("###MEETINGDATA_SPEAKERS###",10)},L={topic:{}},r={topic:0,speaker:0},p={topic:0,speaker:0,
eventBreak:false},e={onTime:[],onSeek:[],onPlay:[],onPause:[]},x={},F={},G={topic:false,speaker:false},D={onTime:function(a,b){return function(c){c.position>=a.start&&c.position<a.start+0.4&&a.id!==p[b]&&a.playlist===o()&&B(a.id,b)}},onSeek:function(a,b){return function(c){if(c.offset>=a.start&&c.offset<a.end&&a.playlist===o()){a.id!==p[b]&&B(a.id,b);G[b]=true}}},onSeekFinal:function(a){return function(){!G[a]&&p[a]!==0&&m(a);G[a]=false}}},g={player:"tx-streamovations-vp-play",playerContainer:"video-player-container",
smvWrapper:"smvplayer_engineWrapper_",html5Wrapper:"_html5videotag",data:"tx-streamovations-vp-playerdata",topicTimeline:"tx-streamovations-vp-topictimeline",speakerTimeline:"tx-streamovations-vp-speakertimeline",container:"tx-streamovations-vp"},i={no_svpp:"SVPP not loaded, polling inactive",svpp_off:"Polling disabled",no_player_data:"The player element or player data is not available",no_playlist:"Missing essential playlist data",no_json_support:"No JSON.parse support in user agent",player_data_invalid:"Player data is invalid or in an unsupported format",
invalid_player:"No supported player configured",no_jwplayer:"No jwplayer loaded",no_jwplayer_key:"A jwplayer license key is required",no_smvplayer:"No smvplayer loaded",events_topic_init:"initializing topic event handlers",events_speaker_init:"initializing speaker event handlers",events_re:"Reattached event callbacks",no_timestamp:"Topic has no registered timestamps",no_playlist_seek:"Can only seek to other playlist item during playback",activate:"Activated"};f.fn.exists=function(){return this.length!==
0};var u=null,z=null,s=null,y=null,o=null,C=null,A=null,q=null,d={player:null,jw:null,smv:null,isLiveStream:false,init:function(){var a=f("."+g.playerContainer),b=f("#"+g.data).first();if(!a.exists()||!b.exists()){h(i.no_player_data,true);return false}var c=null;try{c=JSON.parse(b.html().trim())}catch(k){h(i.no_json_support,true);return false}b.html("");if(typeof c!=="object"){h(i.player_data_invalid,true);return false}switch(da){case 3:if(!Z(c))return false;break;case 2:if(!ba(c))return false;break;
case 1:if(!ca(c))return false;break;default:h(i.invalid_player,true);return false}s(function(){a.trigger("SVPS:play")});if(c.hasOwnProperty("application"))this.isLiveStream=c.application==="rtplive";if(this.isLiveStream){if(l.topic||l.speaker||l.breaks){P();Q()}}else X();return true},processMeetingdataChange:function(a){if(l.topic){a.hasOwnProperty("topics")&&a.topics!==false&&a.topics.length>r.topic&&J(a.topics.slice(r.topic),"topic");a.hasOwnProperty("topicTimeline")&&a.topicTimeline!==false&&a.topicTimeline.length>
0&&I(a.topicTimeline,"topic")}if(l.speaker){a.hasOwnProperty("speakers")&&a.speakers!==false&&a.speakers.length>r.speaker&&J(a.speakers.slice(r.speaker),"speaker");a.hasOwnProperty("speakerTimeline")&&a.speakerTimeline!==false&&a.speakerTimeline.length>0&&I(a.speakerTimeline,"speaker")}l.breaks&&a.hasOwnProperty("eventBreaks")&&a.eventBreaks!==false&&a.eventBreaks.length>0&&S(a.eventBreaks)},jumpToTopic:function(a){a=L.topic[a];a!==undefined?A(a):h(i.no_timestamp,true)}};return d}(jQuery);